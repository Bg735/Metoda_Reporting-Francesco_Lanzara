{
    "AllowedHosts": "*",
    "Logging": {
        "LogLevel": {
            "Default": "Debug",
            "Microsoft.AspNetCore": "Debug",
            "Microsoft.AspNetCore.Server.Kestrel": "Debug",
            "Yarp.ReverseProxy": "Debug"
        }
    },
    "Kestrel": {
        "EndpointDefaults": {
            "ForwardedHeaders": "All"
        }
    },
    "ReverseProxy": {
        "ForwardedHeaders": {
            "Enabled": true,
            "XForwarded": {
                "Prefix": "X-Forwarded-",
                "UseOriginalHost": true,
                "UseOriginalProto": true
            }
        },
        "Routes": {
            "auth_connect": {
                "ClusterId": "authserver",
                "Match": { "Path": "/connect/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "auth_account": {
                "ClusterId": "authserver",
                "Match": { "Path": "/Account/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "auth_wellknown": {
                "ClusterId": "authserver",
                "Match": { "Path": "/.well-known/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "auth_identity": {
                "ClusterId": "authserver",
                "Match": { "Path": "/Identity/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "static_css": {
                "ClusterId": "authserver",
                "Match": { "Path": "/css/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "static_lib": {
                "ClusterId": "authserver",
                "Match": { "Path": "/lib/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "static_js": {
                "ClusterId": "authserver",
                "Match": { "Path": "/js/{**catchall}" },
                "Transforms": [
                    {
                        "RequestHeader": "Host",
                        "Set": "localhost:8080"
                    },
                    {
                        "RequestHeader": "X-Forwarded-Proto",
                        "Set": "http"
                    }
                ]
            },
            "api": {
                "ClusterId": "restapi",
                "Match": { "Path": "/api/{**catchall}" },
                "Transforms": [
                    { "RequestHeaderOriginalHost": true },
                    { "Forwarded": "for,host,proto" }
                ]
            },
            "mvc": {
                "ClusterId": "mvcclient",
                "Match": { "Path": "{**catchall}" },
                "Transforms": [
                    { "RequestHeaderOriginalHost": true },
                    { "Forwarded": "for,host,proto" }
                ]
            }
        },

        //        // modifica inserimento di Anonymus nelle rotte che probabilmente causano il loop
        //        "Routes": {
        //            "auth_connect": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/connect/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    {
        //                        "RequestHeader": "X-Forwarded-Proto",
        //                        "Set": "http"
        //                    },
        //                    {
        //                        "RequestHeader": "X-Forwarded-Host",
        //                        "Set": "localhost:8080"
        //                    },
        //                    {
        //                        "RequestHeader": "X-Forwarded-For",
        //                        "Set": "true"
        //                    }
        //                ]
        //            },
        //            "auth_account": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/Account/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    {
        //                        "RequestHeader": "X-Forwarded-Proto",
        //                        "Set": "http"
        //                    },
        //                    {
        //                        "RequestHeader": "X-Forwarded-Host",
        //                        "Set": "localhost:8080"
        //                    }
        //                ]
        //            },
        //            "auth_wellknown": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/.well-known/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    // 1) conserva l’Host originale ricevuto dal client
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    // 2) abilita l’invio degli X-Forwarded-*
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "auth_identity": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/Identity/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    // 1) conserva l’Host originale ricevuto dal client
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    // 2) abilita l’invio degli X-Forwarded-*
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "api": {
        //                "ClusterId": "restapi",
        //                "Match": { "Path": "/api/{**catchall}" },
        //                //"AuthorizationPolicy": "Authenticated",
        //                "Transforms": [
        //                    // 1) conserva l’Host originale ricevuto dal client
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    // 2) abilita l’invio degli X-Forwarded-*
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "mvc": {
        //                "ClusterId": "mvcclient",
        //                "Match": { "Path": "{**catchall}" },
        //                //"AuthorizationPolicy": "Authenticated",
        //                "Transforms": [
        //                    // 1) conserva l’Host originale ricevuto dal client
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    // 2) abilita l’invio degli X-Forwarded-*
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "static_css": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/css/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "static_lib": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/lib/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            },
        //            "static_js": {
        //                "ClusterId": "authserver",
        //                "Match": { "Path": "/js/{**catchall}" },
        //                //"AuthorizationPolicy": "Anonymous",
        //                "Transforms": [
        //                    { "RequestHeaderOriginalHost": "true" },
        //                    { "Forwarded": "for,host,proto" }
        //                ]
        //            }
        //        },
        "Clusters": {
            "restapi": {
                "Destinations": {
                    "restapi": { "Address": "http://restapi:8080" }
                }
            },
            "mvcclient": {
                "Destinations": {
                    "mvcclient": { "Address": "http://mvcclient:8080" }
                }
            },
            "authserver": {
                "Destinations": {
                    "authserver": {
                        "Address": "http://authserver:8080"
                    }
                }
            }
        }
    }
    //"Authentication": {
    //    "OpenIdConnect": {
    //        "ClientId": "yarpclient",
    //        "ClientSecret": "secret_client"
    //    },
    //    "JwtBearer": {
    //        "Audience": "gateway-api"
    //    }
    //}
}
